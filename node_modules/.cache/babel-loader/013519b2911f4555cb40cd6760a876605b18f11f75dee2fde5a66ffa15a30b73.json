{"ast":null,"code":"import _toConsumableArray from\"D:/Downloads/Computer-science/MyProject/react-pizza/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _objectSpread from\"D:/Downloads/Computer-science/MyProject/react-pizza/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _regeneratorRuntime from\"D:/Downloads/Computer-science/MyProject/react-pizza/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"D:/Downloads/Computer-science/MyProject/react-pizza/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import React,{useEffect,useRef}from'react';import qs from'qs';import{useNavigate}from'react-router-dom';import{useSelector}from'react-redux';import{setCurrentPage,setFilters,setCategoryId}from'../redux/filter/slice';import{selectFilter}from'../redux/filter/selectors';import{fetchPizzas}from'../redux/pizza/asinkActions';import{selectPizzaData}from'../redux/pizza/selectors';import{useAppDispatch}from'../redux/store';import Categories from'../components/Categories';import Sort from'../components/SortPopup';import PizzaBlock from'../components/PizzaBlock';import Skeleton from'../components/PizzaBlock/Skeleton';import Pagination from'../components/Pagination';import{listPopup}from'../components/SortPopup';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Home=function Home(){var navigate=useNavigate();var dispatch=useAppDispatch();var isSearch=useRef(false);var isMounted=useRef(false);var _useSelector=useSelector(selectFilter),categoryId=_useSelector.categoryId,sort=_useSelector.sort,currentPage=_useSelector.currentPage,searchValue=_useSelector.searchValue;var _useSelector2=useSelector(selectPizzaData),items=_useSelector2.items,status=_useSelector2.status;var filter=useSelector(function(state){return state.filter.categoryId;});var getPizzas=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var sortBy,order,category,search;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:sortBy=sort.sortProperty.replace('-','');order=sort.sortProperty.includes('-')?'asc':'desc';category=categoryId>0?\"category=\".concat(categoryId):'';search=searchValue?\"&search=\".concat(searchValue):'';dispatch(fetchPizzas({sortBy:sortBy,order:order,category:category,search:search,currentPage:String(currentPage)}));window.scrollTo(0,0);case 6:case\"end\":return _context.stop();}}},_callee);}));return function getPizzas(){return _ref.apply(this,arguments);};}();useEffect(function(){if(isMounted.current){var params={categoryId:categoryId>0?categoryId:null,sortProperty:sort.sortProperty,currentPage:currentPage};var queryString=qs.stringify(params,{skipNulls:true});navigate(\"?\".concat(queryString));}if(!window.location.search){dispatch(fetchPizzas({}));}},[categoryId,sort.sortProperty,currentPage]);useEffect(function(){if(window.location.search){var params=qs.parse(window.location.search.substring(1));var _sort=listPopup.find(function(obj){return obj.sortProperty===params.sortBy;});dispatch(setFilters({searchValue:params.search,categoryId:Number(params.category),currentPage:Number(params.currentPage),sort:_sort||listPopup[0]}));isSearch.current=true;}},[]);useEffect(function(){window.scrollTo(0,0);if(!isSearch.current){getPizzas();}isSearch.current=false;},[categoryId,sort.sortProperty,searchValue,currentPage]);var pizzas=items.map(function(obj,index){return/*#__PURE__*/_jsx(PizzaBlock,_objectSpread({},obj),obj.id);});var skeletons=_toConsumableArray(new Array(6)).map(function(_,index){return/*#__PURE__*/_jsx(Skeleton,{},index);});var onChangePage=function onChangePage(page){dispatch(setCurrentPage(page));};var onChangeCategory=React.useCallback(function(id){dispatch(setCategoryId(id));},[]);return/*#__PURE__*/_jsxs(\"div\",{className:\"container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"content__top\",children:[/*#__PURE__*/_jsx(Categories,{onChangeCategory:onChangeCategory,value:filter}),/*#__PURE__*/_jsx(Sort,{value:sort})]}),/*#__PURE__*/_jsx(\"h2\",{className:\"content__title\",children:\"\\u0412\\u0441\\u0435 \\u043F\\u0438\\u0446\\u0446\\u044B\"}),status==='error'?/*#__PURE__*/_jsxs(\"div\",{className:\"content__error-info\",children:[/*#__PURE__*/_jsxs(\"h2\",{children:[\"\\u041F\\u0440\\u043E\\u0438\\u0437\\u043E\\u0448\\u043B\\u0430 \\u043E\\u0448\\u0438\\u0431\\u043A\\u0430 \",/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83D\\uDE15\"})]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"\\u041A \\u0441\\u043E\\u0436\\u0430\\u043B\\u0435\\u043D\\u0438\\u044E \\u043D\\u0435 \\u0443\\u0434\\u0430\\u043B\\u043E\\u0441\\u044C \\u043F\\u043E\\u043B\\u0443\\u0447\\u0438\\u0442\\u044C \\u043F\\u0438\\u0446\\u0446\\u044B\",/*#__PURE__*/_jsx(\"br\",{}),\"\\u041F\\u043E\\u043F\\u0440\\u043E\\u0431\\u0443\\u0439\\u0442\\u0435 \\u043F\\u043E\\u0432\\u0442\\u043E\\u0440\\u0438\\u0442\\u044C \\u043F\\u043E\\u043F\\u044B\\u0442\\u043A\\u0443 \\u043F\\u043E\\u0437\\u0436\\u0435.\"]})]}):/*#__PURE__*/_jsx(\"div\",{className:\"content__items\",children:status==='loading'?skeletons:pizzas}),/*#__PURE__*/_jsx(Pagination,{currentPage:currentPage,onChangePage:onChangePage})]});};export default Home;","map":{"version":3,"names":["React","useEffect","useRef","qs","useNavigate","useSelector","setCurrentPage","setFilters","setCategoryId","selectFilter","fetchPizzas","selectPizzaData","useAppDispatch","Categories","Sort","PizzaBlock","Skeleton","Pagination","listPopup","Home","navigate","dispatch","isSearch","isMounted","categoryId","sort","currentPage","searchValue","items","status","filter","state","getPizzas","sortBy","sortProperty","replace","order","includes","category","search","String","window","scrollTo","current","params","queryString","stringify","skipNulls","location","parse","substring","find","obj","Number","pizzas","map","index","id","skeletons","Array","_","onChangePage","page","onChangeCategory","useCallback"],"sources":["D:/Downloads/Computer-science/MyProject/react-pizza/src/pages/Home.tsx"],"sourcesContent":["import React, { useEffect, useRef } from 'react'\nimport qs from 'qs'\nimport { useNavigate } from 'react-router-dom'\n\nimport { useSelector } from 'react-redux'\nimport { setCurrentPage, setFilters, setCategoryId } from '../redux/filter/slice'\nimport { selectFilter } from '../redux/filter/selectors'\nimport { fetchPizzas } from '../redux/pizza/asinkActions'\nimport { SearchPizzaParams } from '../redux/pizza/types'\nimport { selectPizzaData } from '../redux/pizza/selectors'\nimport { useAppDispatch } from '../redux/store'\n\nimport Categories from '../components/Categories'\nimport Sort from '../components/SortPopup'\nimport PizzaBlock from '../components/PizzaBlock'\nimport Skeleton from '../components/PizzaBlock/Skeleton'\nimport Pagination from '../components/Pagination'\nimport { listPopup } from '../components/SortPopup'\n\nconst Home: React.FC = () => {\n    const navigate = useNavigate()\n    const dispatch = useAppDispatch()\n    const isSearch = useRef(false)\n    const isMounted = useRef(false)\n    const { categoryId, sort, currentPage, searchValue } = useSelector(selectFilter)\n    const { items, status } = useSelector(selectPizzaData)\n    const filter = useSelector((state: any) => state.filter.categoryId)\n\n    const getPizzas = async () => {\n        const sortBy = sort.sortProperty.replace('-', '')\n        const order = sort.sortProperty.includes('-') ? 'asc' : 'desc'\n        const category = categoryId > 0 ? `category=${categoryId}` : ''\n        const search = searchValue ? `&search=${searchValue}` : ''\n\n        dispatch(\n            fetchPizzas({\n                sortBy,\n                order,\n                category,\n                search,\n                currentPage: String(currentPage),\n            })\n        )\n        window.scrollTo(0, 0)\n    }\n\n    useEffect(() => {\n        if (isMounted.current) {\n            const params = {\n                categoryId: categoryId > 0 ? categoryId : null,\n                sortProperty: sort.sortProperty,\n                currentPage,\n            }\n\n            const queryString = qs.stringify(params, { skipNulls: true })\n\n            navigate(`?${queryString}`)\n        }\n        if (!window.location.search) {\n            dispatch(fetchPizzas({} as SearchPizzaParams))\n        }\n    }, [categoryId, sort.sortProperty, currentPage])\n\n    useEffect(() => {\n        if (window.location.search) {\n            const params = qs.parse(\n                window.location.search.substring(1)\n            ) as unknown as SearchPizzaParams\n            const sort = listPopup.find((obj) => obj.sortProperty === params.sortBy)\n\n            dispatch(\n                setFilters({\n                    searchValue: params.search,\n                    categoryId: Number(params.category),\n                    currentPage: Number(params.currentPage),\n                    sort: sort || listPopup[0],\n                })\n            )\n            isSearch.current = true\n        }\n    }, [])\n\n    useEffect(() => {\n        window.scrollTo(0, 0)\n        if (!isSearch.current) {\n            getPizzas()\n        }\n        isSearch.current = false\n    }, [categoryId, sort.sortProperty, searchValue, currentPage])\n\n    const pizzas = items.map((obj: any, index: number) => <PizzaBlock key={obj.id} {...obj} />)\n\n    const skeletons = [...new Array(6)].map((_, index) => <Skeleton key={index} />)\n\n    const onChangePage = (page: number) => {\n        dispatch(setCurrentPage(page))\n    }\n\n    const onChangeCategory = React.useCallback((id: number) => {\n        dispatch(setCategoryId(id))\n    }, [])\n\n    return (\n        <div className='container'>\n            <div className='content__top'>\n                <Categories onChangeCategory={onChangeCategory} value={filter} />\n                <Sort value={sort} />\n            </div>\n            <h2 className='content__title'>Все пиццы</h2>\n            {status === 'error' ? (\n                <div className='content__error-info'>\n                    <h2>\n                        Произошла ошибка <span>😕</span>\n                    </h2>\n                    <p>\n                        К сожалению не удалось получить пиццы\n                        <br />\n                        Попробуйте повторить попытку позже.\n                    </p>\n                </div>\n            ) : (\n                <div className='content__items'>{status === 'loading' ? skeletons : pizzas}</div>\n            )}\n            <Pagination currentPage={currentPage} onChangePage={onChangePage} />\n        </div>\n    )\n}\n\nexport default Home\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}